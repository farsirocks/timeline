<!DOCTYPE HTML>
<html dir="rtl">
<head lang="fa-IR">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Timeline Farsi</title>

    <link href="/assets/style.css" rel="stylesheet" type="text/css"/>
    <link href="/assets/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css"/>

</head>
<body>

<main style="padding: 2rem 5rem">
    <div id='root'></div>
</main>


<script src="/assets/react.development.js"></script>
<script src="/assets/react-dom.development.js"></script>
<script src="/assets/react-dom-server.browser.development.js"></script>
<script src="/assets/browser.min.js"></script>
<script src="/assets/moment.min.js"></script>
<script src="/assets/fa.js"></script>
<script src="/assets/moment-jalaali.js"></script>
<script src="/assets/vis-timeline-graph2d.min.js"></script>
<script type="text/babel">
    moment.loadPersian({
        dialect: 'persian-modern',
        usePersianDigits: true
    })


    window.items = new vis.DataSet();
    items.add([
        {id: 1, content: 'تولد', start: '2021-01-18'},
        {id: 2, content: 'مهد کودک', start: '2021-01-20'},
        {id: 3, content: 'ابتدایی', start: '2021-01-21'},
        {id: 4, content: 'نگارش کتاب', start: '2021-01-22', end: '2021-01-26'},
        {id: 5, content: 'جایزه اسکار', start: '2021-01-27', type: 'point'},
        {id: 6, content: 'مرگ', start: '2021-01-30'},
        {id: 7, content: 'آزمایشی', start: '2041-01-30'}

    ]);


    /*
    // create groups

    var numberOfGroups = 25;
    var groups = new vis.DataSet()
    for (var i = 0; i < numberOfGroups; i++) {
        groups.add({
            id: i,
            content: 'Truck ' + i
        })
    }

    window.items = new vis.DataSet();
    var itemsPerGroup = Math.round(numberOfItems / numberOfGroups);
    for (var truck = 0; truck < numberOfGroups; truck++) {
      var date = new Date();
      for (var order = 0; order < itemsPerGroup; order++) {
          date.setHours(date.getHours() + 4 * (Math.random() < 0.2));
          var start = new Date(date);
          date.setHours(date.getHours() + 2 + Math.floor(Math.random() * 4));
          var end = new Date(date);
          items.add({
              id: order + itemsPerGroup * truck,
              group: truck,
              start: start,
              end: end,
              content: 'Order ' + order
          });
      }
    }
    */

    var GroupTemplate = (group) => {
        return <div>
            <label>{group.content}</label>
        </div>
    }

    class ItemTemplate extends React.Component {
        constructor(props) {
            super(props);
        }

        render() {
            return <div>
                <label>{this.props.item.content}</label>
            </div>
        }
    }

    class VisibleFramTemplate extends React.Component {
        constructor(props) {
            super(props);
        }

        render() {
            return <div>
                id: {this.props.item.id}
                <button onClick={() => {
                    return console.log('aaaaaa')
                }}>aaaa
                </button>
            </div>
        }
    }
    function getStartDate()
    {
        //todo: dynamic, read from data
        return '2021-01-1'
    }
    function getEndDate()
    {
        //todo: dynamic, read from data
        return '2021-02-10'
    }
    var persian_options = {
        start: getStartDate(),
        end: getEndDate(),
        height: '300px',
        locales: {
            fa: {
                current: 'الان',
                time: 'زمان',
                deleteSelected: 'حذف انتخاب شده',
            },
        },
        locale: 'fa',
        rtl: true,
        format: {
            minorLabels: {
                millisecond: 'SSS',
                second: 's',
                minute: 'HH:mm',
                hour: 'HH:mm',
                weekday: 'ddd jD',
                day: 'jD',
                week: 'w',
                month: 'jMMMM',
                year: 'jYYYY'
            },
            majorLabels: {
                millisecond: 'HH:mm:ss',
                second: 'jD jMMMM HH:mm',
                minute: 'ddd jD jMMMM',
                hour: 'ddd jD jMMMM',
                weekday: 'jMMMM jYYYY',
                day: 'jMMMM / jYYYY',
                week: 'jMMMM jYYYY',
                month: 'jYYYY',
                year: ''
            }
        }
    };

    // specify options
    var options = {
        orientation: 'top',
        start: new Date(),
        end: new Date(1000 * 60 * 60 * 24 + (new Date()).valueOf()),
        editable: true,
        onInitialDrawComplete: () => {
            window.timeline.setItems(window.items)
        },
        template: function (item, element) {
            if (!item) {
                return
            }

            return ReactDOM.createPortal(ReactDOM.render(<ItemTemplate item={item}/>, element), element, () => {
                window.timeline.redraw()
            });

            // Works too
            // return ReactDOMServer.renderToString(<ItemTemplate item={item} />)

            // Kinda works
            // ReactDOM.render(<ItemTemplate item={item} />, element );
            // return ''
        },

        groupTemplate: function (group, element) {
            if (!group || !group.content) {
                return
            }
            return ReactDOM.createPortal(ReactDOM.render(<GroupTemplate group={group}/>, element), element);
        },

        visibleFrameTemplate: function (item, element) {
            if (!item || !element) {
                return
            }
            if (element.className.indexOf('timeline-item-visible-frame') === -1) {
                return
            }
            return ReactDOM.createPortal(ReactDOM.render(<VisibleFramTemplate item={item}/>, element), element);

        },
    }

    class Timeline extends React.Component {
        componentDidMount() {
            return initTimeline();
        }

        render() {
            return <div>
                <h1>تایم لاین فارسی و شمسی</h1>
                <h2>با استفاده از ری اکت بصورت استاتیک</h2>

                <div id="visualization"></div>
            </div>
        }
    };

    function initTimeline() {
        var container = document.getElementById('visualization');
        window.timeline = new vis.Timeline(container, items, {...options, ...persian_options});
    }

    ReactDOM.render(<Timeline/>, document.getElementById('root'));
</script>
</body>
</html>
